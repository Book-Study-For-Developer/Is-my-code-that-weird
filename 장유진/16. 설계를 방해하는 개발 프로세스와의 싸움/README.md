# 16장 설계를 방해하는 개발 프로세스와의 싸움

개발 프로세스 자체가 레거시 코드의 발생 원인이 되기도 합니다.

## 1. 커뮤니케이션

### 1.1 커뮤니케이션이 부족하면 설계 품질에 문제가 발생

### 1.2 콘웨이 법칙

콘웨이 법칙은 '시스템의 구조는 그것을 설계하는 조직의 구조를 닮아 간다'라는 법칙입니다.<br>
릴리스 기능의 밀도는 팀의 밀도와 가까워집니다.<br>
결국 시스템의 구조가 릴리스 단위, 즉 팀 단위의 구조처럼 구성됩니다.<br>
팀 내부에서 이뤄지는 커뮤니케이션은 비용이 낮고, 팀 외부와의 커뮤니케이션은 비용이 높다는 비용 구조 자체가 시스템 구조에 영향을 준다는 것입니다.

최근에는 콘웨이 법칙을 반대로 접근하는 역콘웨이 법칙이 등장했습니다.<br>
'소프트웨어의 구조를 먼저 설계하고, 이후 소프트웨어의 구조에 맞게 조직을 편성한다'는 접근 방법입니다.<br>
그렇지만 역콘웨이 법칙을 표면적으로 내세우는 것만으로는 효과가 크지 않았습니다.

### 1.3 심리적 안정성

심리적 안정성이란 '어떤 발언을 했을 때, 부끄럽거나 거절당하지 않을 것이라는 확신을 느낄 수 있는 심리 상태',<br>
'안심하고 자유롭게 발언 또는 행동할 수 있는 상태' 등으로 정의합니다.<br>
심리적 안정성은 성공적인 팀을 구축할 때 매우 중요한 개념이라고 알려져 있습니다.

## 2. 설계

### 2.1 '빨리 끝내고 싶다'는 심리가 품질 저하의 함정

설계 품질을 신경 쓰지 않고, 어떻게든 작동하는 코드를 빠르게 작성하는 프로그래머는 초반에 빨리 구현할 수 있습니다.<br>
하지만 시간이 지날수록 구현 속도가 느려집니다.<br>
조악한 구현 때문에 코드 수정이 다른 곳에 영향을 미치기 때문입니다.

### 2.2 나쁜 코드를 작성하는 것이 좋은 코드를 작성하는 것보다 오래 걸린다

'클린 아키텍처' 책을 보면 실험에서 TDD를 사용하는 편이 전체적으로 보았을 때 더 빠르다는 결론이 나왔습니다.

### 2.3 클래스 설계와 구현 피드백 사이클 돌리기

사양을 변경할 때는 최소한 메모로라도 클래스 다이어그램을 그려 보세요.<br>
구현하다 보면 예상하지 못했던 요소들을 발견하게 될 것입니다.<br>
이때마다 클래스 다이어그램에 반영해 보기 바랍니다.

### 2.4 한 번에 완벽하게 설계하려고 들지 말고, 사이클을 돌리며 완성하기

**단 한 번의 설계로 완벽한 구조를 만들어 낼 수는 없습니다.**<br>
설계 품질은 설계와 구현 피드백 사이클을 계속해서 돌리면, 조금씩 향상되는 것입니다.

### 2.5 '성능이 떨어질 수 있으니 클래스를 작게 나누지 말자'는 맞는 말일까?

클래스가 많아지면 비용이 발생하는 것은 맞습니다.<br>
하지만 대부분의 상황에는 무시할 수 있는 정도입니다.<br>
병목이 어디인지 모른 채 성능이 빠른 코드를 작성하려고만 하는 것은 **너무 빠른 최적화**라고 하는 안티패턴에 해당합니다.

### 2.6 설계 규칙을 다수결로 결정하면 코드 품질은 떨어진다

다수결 또는 만장일치로 코드와 설계를 결정하려고 하면, 아무래도 수준이 낮은 쪽에 맞춰서 하향평준화되기 쉽기 때문입니다.

### 2.7 설계 규칙을 정할 때 중요한 점

각각의 설계 규칙에는 이유와 의도를 함께 적는 것이 좋습니다.

- 설계 규칙은 성능이나 프레임워크의 제약 등 다양한 요건과 트레이드오프될 가능성이 있다.
- 규칙을 무조건 지켜야 하는 것은 아니며, 타협점을 찾아야 하는 상황도 분명히 존재한다.

설계를 어느 정도 아는 팀원이 설계 리뷰와 코드 리뷰를 하도록 해서,<br>
리뷰와 스터디 등을 통해서 의도를 계속 전달하면, 다른 구성원들도 조금씩 의도를 이해하게 될 것입니다.<br>
팀 구성원의 설계 역량이 어느 정도 성죽해지면, 다시 한 번 설계 규칙에 대해서 논의하는 것도 좋습니다.

## 3. 구현

### 3.1 깨진 유리창 이론과 보이스카우트 규칙

깨진 유리창 이론은 너무 유명한 이론이라 따로 설명하지 않겠습니다.<br>
소프트웨어 개발에 접목하면 '조악하고 복잡하고 질서 없는 코드가 방치되면, 소프트웨어 전체가 점점 더 무질서해진다.'는 것입니다.

보이스카우트 규칙은 '캠핑장을 자신이 왔을 때보다 더 깨끗하게 치우고 가기'입니다.<br>
코드를 변경할 때, 자신이 변경하기 전보다 더 깨끗한 상태로 만들어 커밋하는 것입니다.

### 3.2 기존의 코드를 믿지 말고, 냉정하게 파악하기

레거시 코드를 박멸하려면, 기존의 코드를 맹신하지 않는 마음가짐이 중요합니다.<br>
첫 번째 장애물은 **앵커링 효과**라고 하는 심리 작용입니다.<br>
이는 처음 제시한 수치와 정보가 기준이 되어, 이후의 판단을 왜곡하는 인지 편향을 의미합니다.<br>
두 번째 장애물은 이름이 없거나, 이름을 모르는 것은 인지하기 어렵다는 것입니다.

### 3.3 코딩 규칙 사용하기

작성 방식에 통일성이 없다면, 코드를 읽기가 매우 힘들어집니다.<br>
코딩 규칙이란 코드의 가독성과 유지 보수성 향상, 문제가 있는 코드를 미연에 방지하기 위한 목적 등으로 코딩 스타일과 명명 규칙 등을 정해 놓은 것입니다.

### 3.4 명명 규칙

명명 규칙이란 변수 이름, 클래스 이름, 메서드 이름을 정하는 규칙입니다.<br>
예를 들어서 'Google Java Style Guide'가 있습니다.

## 4. 리뷰

### 4.1 코드 리뷰 구조화하기

레거시 코드가 작성되는 현장이라면, 코드 리뷰를 하는 습관 자체가 없는 경우가 많습니다.<br>
어떻게든 동작하도록 작성된 난잡한 코드가 누구의 확인도 받지 않고 병합됩니다.<br>
이러한 코드는 결국 품질이 떨어져, 버그가 빈번하게 발생합니다.

### 4.2 코드를 설계 시점에 리뷰하기

많은 사람이 코드 리뷰를 '로직이 기능 요건을 만족하는지, 결함이 존재하는지, 코딩 스타일을 지키고 있는지 리뷰하는 것'이라고 생각합니다.<br>
하지만 이보다는 **설계적 타당성을 중심으로 리뷰해야 합니다.**

### 4.3 존중과 예의

코드 리뷰 시 '기술적 올바름'을 두고, 공격적인 코멘트를 다는 사람이 있습니다.<br>
하지만 아무리 옳은 말이라고 해도, 공격적 코멘트를 허용해서는 안됩니다.<br>
이러한 리뷰는 사람에게 상처를 주고, 생산성을 저하시키는 것은 물론, 코드를 좋게 만든다는 본래의 목표도 저해합니다.<br>
코드 리뷰에서 가장 중요한 것은 존중과 예의 입니다.

다음은 코드 리뷰에서 '해야 하는 것'과 '하지 말아야 하는 것'입니다.

| 해야 하는 것             | 설명                                                                                                                                       |
|---------------------|------------------------------------------------------------------------------------------------------------------------------------------|
| 능력과 선의를 갖고 있다고 생각하기 | 개발자는 능력이 있고, 선의를 갖고 있다고 생각하세요.<br/> 실수는 정보 부족으로 인해 발생하는 것이라고 생각하세요.                                                                      |
| 만나서 이야기 하기          | 리뷰 도구만으로 의견이 모이지 않는 경우, 직접 만나 의견을 교환하게요.                                                                                                 |
| 이유를 설명하기            | 왜 잘못되었는지, 어떤 변경이 더 좋은지 설명하세요.<br/> '이렇게 하면 안됩니다.'라는 말만으로는 의견이 상대방에게 전달되지 않습니다.                                                           |
| 이유 듣기               | 상대방의 의도를 잘 모르겠다면, 주저하지 말고 변경이유를 물어보세요.<br/> 의견을 교환하고 기록하면, 이후의 변경 의도도 더 잘 알 수 있게 될 것입니다.<br/> 또한 더 좋은 구현을 생각할 기회가 됩니다.                   |
| 잘 끝맺기               | 완벽을 위해서 너무 철저하게 리뷰하다 보면, 리뷰를 받는 사람이 너무 힘들어집니다.<br/>완벽을 찾으려고 하기보다, '이렇게 하는 것이 더 좋을 것 같다'라는 의견으로 리뷰를 적절하게 끝맺는 것이 좋습니다.                     |
| 적절한 시간 내에 답변하기      | 리뷰를 계속 방치하지 마세요. 24시간 내에 답변할 수 없다면, 언제까지 답변할 수 있는지 코멘트를 달아 주는 등 적절한 방법으로 대응하세요.                                                          |
| 긍정적인 부분 이야기하기       | 리뷰는 '모든 잘못된 부분을 찾겠다'는 비판적인 마음으로 임하지 말고, 긍정적인 부분을 인정하는 자세로 임하세요.<br/> 억지로 무리해서 칭찬할 필요는 없지만, 어려운 일을 맡은 사람과 좋은 변경을 한 사람에게 감사하는 마음을 표현해 보세요. |

| 하지 말아야 하는 것           | 설명                                                                                                                  |
|-----------------------|---------------------------------------------------------------------------------------------------------------------|
| 나쁜 말 사용하지 않기          | 상대방이 최선을 다하고 있다는 것을 전제로 합니다.<br/> '왜 신경쓰지 못했죠?'처럼 공격적인 말을 달아서는 안됩니다.                                                |
| 극단적이고 부정적인 표현 사용하지 않기 | '일반적인 사람이라면 이러지 않는다', '끔찍한 알고리즘이다' 같은 부정적인 표현을 사용해서는 안됩니다.<br/> 사람을 공격해서 움직이려고 하면 안 됩니다. 사람이 아니라 코드에 대해서 이야기해야 합니다. |
| 도구 사용을 단념시키지 말기       | 작성자가 코드 포매터 등 자동화 도구를 사용했다면, 일단 그 자체에 감사해야 합니다.<br/> 도구 사용에 대해 시비를 걸거나, 도구에 대한 취향을 강요해서는 안됩니다.                      |
| 사소한 것으로 오랜 시간 끌지 않기   | 어떻게 해도 괜찮을 것 같은 경우, 리뷰에서 둘 중 하나를 결정하려 하지 마세요. 리뷰의 목적은 '이기고 지는 것'이 아닙니다.                                             |

다음 지적은 기술적으로는 정확하겠지만, 선의와 예의가 부족한 예시입니다.<br>
'여기에서 ㅇㅇ 메서드는 사용하지 마세요. 성능이 나빠집니다. 이런 구현은 좋을 것이 아무것도 없습니다.'<br>
이 지적은 다음과 같이 수정하는 것이 좋습니다.<br>
'동작도 잘하고 충분히 좋은 변경입니다. 하지만 성능을 조금 더 개선할 수 있을 것 같습니다.<br>
현재 ㅇㅇ 메서드를 활용해서 구현했는데, ㅁㅁ 메서드를 활용하는 편이 실행 속도 측명에서 더 유리합니다.'

### 4.4 정기적으로 개선 작업 진행하기

구현 또는 코드 리뷰 중간에 좋지 않은 코드를 발견했는데, 스케줄 문제로 대처하지 못하는 경우가 있을 수 있습니다.<br>
좋지 않은 코드에 대처하는 일은 작업 관리 도구에 개선 작업으로 추가해 두기 바랍니다.

## 5. 팀의 설계 능력 높이기

팀 전체의 설계 능력이 부족하면, 설계 능력을 높이기 위한 활동이 필요합니다.

### 5.1 영향력을 갖는 규모까지 동료 모으기

설계뿐만 아니라 일의 방식을 상향식으로 개선하려면, 주위의 협력이 반드시 필요합니다.<br>
우선 영향력을 가질 수 있을 만큼 동료를 모으는 게 중요합니다.

### 5.2 천리길도 한 걸음부터

사람은 한 번에 대량의 정보를 받아들일 수 없으며, 큰 변화에 대해 불안과 저항을 느낍니다.<br>
매일매일 조금씩 설계 지식을 공유하도록 합시다.

### 5.3 백문이 불여일견

프로덕션 코드를 사용한 개선 실험을 추천합니다.<br>
복잡하고 무질서한 코드를 간단하고 질서 있는 코드로 개선해보면, 설계의 효과를 확실하게 실감할 수 있습니다.

### 5.4 팔로우업 스터디 진행하기

인풋보다 아웃풋이 학습 효과가 높다고 합니다.<br>
저자가 추천하는 스터디 방식입니다.

1. 책에 적혀 있는 노하우를 1-2개 정도 읽어 봅니다.
2. 프로덕션 코드에서 노하우를 적용해 볼 수 있는 부분을 찾습니다. 직접 다루던 코드면 더욱 좋습니다.
3. 노하우를 사용해 코드를 개선해 봅니다.
4. 어떻게 개선했는지 Before & After 를 비교할 우 있게 발표합니다.
5. 발표 내용에 대해 질의 응답과 논의를 합니다.

스터디는 한 번에 한 시간 정도, 스몰 스탭으로 반복합니다.

### 5.5 스터디 그룹에서 발생할 수 있는 문제 해결 노하우

- 단순하게 책을 읽기만 하는 스터디는 추천하지 않습니다.
- '이것이 올바른 설계 방법이니 무조건 이렇게 해야 합니다'라고 강요하는 것도 좋지 않습니다.
- 스터디에서도 설계 관련 기술을 무리하게 전달하려 하지 말고, 차근차근 전달해야 합니다.

### 5.6 리더와 매니저에게 설계의 중요성과 비용 대비 효과 설명하기

조직 차원에서 설계 품질을 향상시키려면, 개발 프로세스 흐름에 설계를 추가해야 합니다.<br>
그러려면 리더와 매니저도 설계의 필요성을 공유해야 합니다.<br>
정식으로 프로세스에 추가하지 못하면, 다른 일을 먼저 하라고 지시받는 등, 설계와 관련된 일을 시도하기 힘듭니다.

### 5.7 설계 책임자 세우기

설계 책임자는 변경 용이성 품질 향상을 위해, 다음과 같은 내용을 추진합니다.

- 설계 품질과 관련된 규칙이나 개발 프로세스 수립
- 규칙을 반복적으로 알리고 교육
- 리더와 매니저에게 효과 공유
- 품질 시각화
- 설계 품질 유지

설꼐 규칙, 코딩 규칙, 리뷰 방법 등 설계 품질과 관련된 규칙과 개발 프로세스를 수립하도록 합시다.<br>
왜 규칙이 필요한지 이유를 함께 적도록 합시다.
